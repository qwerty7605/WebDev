<div class="min-vh-100 bg-light py-5">
  <div class="container" style="max-width: 800px;">
    <div class="card shadow">
      <div class="card-body p-4">
        <div class="mb-4">
          <h1 class="h3 mb-2">Submit a Complaint</h1>
          <p class="text-muted">Please provide detailed information about your complaint</p>
        </div>

        <form (ngSubmit)="onSubmit()">
          <div class="mb-3">
            <label for="category" class="form-label">Category *</label>
            <select
              id="category"
              name="category"
              [(ngModel)]="formData.category_id"
              [disabled]="isLoading"
              required
              class="form-select"
            >
              <option value="0">Select a category</option>
              @for (category of categories; track category.id) {
                <option [value]="category.id">
                  {{ category.category_name }}
                </option>
              }
            </select>
          </div>

          <div class="mb-3">
            <label for="assignedTo" class="form-label">Assign to Admin (Optional)</label>
            <select
              id="assignedTo"
              name="assignedTo"
              [(ngModel)]="formData.assigned_to"
              [disabled]="isLoading"
              class="form-select"
            >
              <option value="0">Select an admin (optional)</option>
              @for (admin of admins; track admin.id) {
                <option [value]="admin.id">
                  {{ admin.full_name }} ({{ admin.role }})
                </option>
              }
            </select>
            <div class="form-text">Choose which admin will handle your complaint</div>
          </div>

          <div class="mb-3">
            <label for="subject" class="form-label">Subject *</label>
            <input
              type="text"
              id="subject"
              name="subject"
              [(ngModel)]="formData.subject"
              placeholder="Brief description of your complaint"
              [disabled]="isLoading"
              required
              maxlength="255"
              class="form-control"
            />
          </div>

          <div class="mb-3">
            <label for="description" class="form-label">Description *</label>
            <textarea
              id="description"
              name="description"
              [(ngModel)]="formData.description"
              placeholder="Provide detailed information about your complaint"
              [disabled]="isLoading"
              required
              rows="6"
              class="form-control"
            ></textarea>
          </div>

          <div class="mb-3">
            <label class="form-label fw-bold">Evidence/Attachment (Optional)</label>
            <div class="text-muted small mb-3">
              For best results, uploads should be at least 1080p (1920 Ã— 1080 pixels). Supported formats: MP4, PNG, JPEG.
            </div>

            @if (!filePreview) {
              <div
                class="drag-drop-zone p-5 text-center border border-2 rounded-3"
                [class.dragging]="isDragging"
                (dragover)="onDragOver($event)"
                (dragleave)="onDragLeave($event)"
                (drop)="onDrop($event)"
                [class.disabled]="isLoading"
              >
                <div class="upload-icon mb-3">
                  <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor" class="bi bi-cloud-upload text-primary" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M4.406 1.342A5.53 5.53 0 0 1 8 0c2.69 0 4.923 2 5.166 4.579C14.758 4.804 16 6.137 16 7.773 16 9.569 14.502 11 12.687 11H10a.5.5 0 0 1 0-1h2.688C13.979 10 15 8.988 15 7.773c0-1.216-1.02-2.228-2.313-2.228h-.5v-.5C12.188 2.825 10.328 1 8 1a4.53 4.53 0 0 0-2.941 1.1c-.757.652-1.153 1.438-1.153 2.055v.448l-.445.049C2.064 4.805 1 5.952 1 7.318 1 8.785 2.23 10 3.781 10H6a.5.5 0 0 1 0 1H3.781C1.708 11 0 9.366 0 7.318c0-1.763 1.266-3.223 2.942-3.593.143-.863.698-1.723 1.464-2.383"/>
                    <path fill-rule="evenodd" d="M7.646 4.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 5.707V14.5a.5.5 0 0 1-1 0V5.707L5.354 7.854a.5.5 0 1 1-.708-.708z"/>
                  </svg>
                </div>
                <div class="mb-2">
                  <strong class="fs-5">Drag and drop files to upload</strong>
                </div>
                <div class="text-muted mb-3">
                  Your upload will be private until you submit the complaint.
                </div>
                <div>
                  <label class="btn btn-primary">
                    <input
                      type="file"
                      class="d-none"
                      (change)="onFileSelected($event)"
                      [disabled]="isLoading"
                      accept="image/jpeg,image/jpg,image/png,video/mp4,video/quicktime,video/x-msvideo,video/x-ms-wmv,video/webm"
                    />
                    Select Files
                  </label>
                </div>
              </div>
            }

            @if (filePreview && fileType === 'image') {
              <div class="preview-container border border-2 rounded-3 p-3">
                <div class="d-flex justify-content-between align-items-center mb-2">
                  <strong>Image Preview</strong>
                  <button
                    type="button"
                    class="btn btn-danger btn-sm"
                    (click)="removeFile()"
                    [disabled]="isLoading"
                  >
                    Remove
                  </button>
                </div>
                <img [src]="filePreview" alt="Preview" class="img-fluid rounded" style="max-height: 400px;" />
                @if (selectedFile) {
                  <div class="mt-2 text-muted small">
                    <div>File: {{ selectedFile.name }}</div>
                    <div>Size: {{ (selectedFile.size / 1024 / 1024).toFixed(2) }} MB</div>
                  </div>
                }
              </div>
            }

            @if (filePreview && fileType === 'video') {
              <div class="preview-container border border-2 rounded-3 p-3">
                <div class="d-flex justify-content-between align-items-center mb-2">
                  <strong>Video Preview</strong>
                  <button
                    type="button"
                    class="btn btn-danger btn-sm"
                    (click)="removeFile()"
                    [disabled]="isLoading"
                  >
                    Remove
                  </button>
                </div>
                <video [src]="filePreview" controls class="w-100 rounded" style="max-height: 400px; background-color: #000;">
                  Your browser does not support the video tag.
                </video>
                @if (selectedFile) {
                  <div class="mt-2 text-muted small">
                    <div>File: {{ selectedFile.name }}</div>
                    <div>Size: {{ (selectedFile.size / 1024 / 1024).toFixed(2) }} MB</div>
                  </div>
                }
              </div>
            }
          </div>

          <div class="mb-3">
            <div class="form-check">
              <input
                type="checkbox"
                id="isAnonymous"
                name="isAnonymous"
                [(ngModel)]="formData.is_anonymous"
                [disabled]="isLoading"
                class="form-check-input"
              />
              <label for="isAnonymous" class="form-check-label">
                Submit anonymously
              </label>
            </div>
            <div class="form-text">Your identity will not be shown to admins if checked</div>
          </div>

          @if (errorMessage) {
            <div class="alert alert-danger" role="alert">
              {{ errorMessage }}
            </div>
          }

          @if (successMessage) {
            <div class="alert alert-success" role="alert">
              {{ successMessage }}
            </div>
          }

          <div class="d-flex gap-2 justify-content-end">
            <button
              type="button"
              class="btn btn-secondary"
              (click)="cancel()"
              [disabled]="isLoading"
            >
              Cancel
            </button>
            <button
              type="submit"
              class="btn btn-primary"
              [disabled]="isLoading"
            >
              @if (!isLoading) {
                <span>Submit Complaint</span>
              }
              @if (isLoading) {
                <span>Submitting...</span>
              }
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
